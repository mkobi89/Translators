---
title: "CLINT Psychometrie"
author: "Matthias Kobi"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document: default
  html_notebook: default
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(plyr)
library(dplyr)
set.seed(1234321)


```



# Data Preprocessing

Prepare data for further analysis.

```{r load_data, echo=FALSE, warning=FALSE}
## get the file names
current_wd <- getwd()
fileNames <- list.files(paste(current_wd,"input", sep="/"), full.names = TRUE)


## read in files

pilot_vpdata <- read.csv(fileNames[4], skip = 1, header = TRUE, sep = ",")
vpdata <- read.csv(fileNames[5], skip =1, header = TRUE, sep = ",")
vpdata_dol <- read.csv(fileNames[1], header = TRUE, sep = ",")

#hgf<-read.csv("/Volumes/Daten/CLINT/04_Auswertungen/Psychometrie/Hintergrundfragebogen/Output/hgf.csv", header = TRUE, sep = ",")
#hgf_incomplete<-read.csv("/Volumes/Daten/CLINT/04_Auswertungen/Psychometrie/Hintergrundfragebogen/Output/hgf_incomplete.csv", header = TRUE, sep = ",")
#hgf_doubles<-read.csv("/Volumes/Daten/CLINT/04_Auswertungen/Psychometrie/Hintergrundfragebogen/Output/hgf_doubles.csv", header = TRUE, sep = ",")






## remove unused rows

pilot_vpdata = pilot_vpdata %>% 
  filter(date !="")

vpdata = vpdata %>% 
  filter(date !="")

vpdata_dol = vpdata_dol %>% 
  filter(Datum !="")

## Join VP and Pilot data and select relevant variables

vpdata = vpdata %>% 
  select(id, group, gender, SpT_Score, HAWIE_T_Value, t_TMT_A_in_s, F_TMT_A, t_TMT_B_in_s, F_TMT_B, Anz_li_Annett, Anz_re_Annett)

pilot_vpdata = pilot_vpdata %>% 
  select(id, group, gender, HAWIE_T_Value, t_TMT_A_in_s, F_TMT_A, t_TMT_B_in_s, F_TMT_B, Anz_li_Annett, Anz_re_Annett)

vpdata = full_join(pilot_vpdata,vpdata, by = c("id", "group", "gender", "HAWIE_T_Value", "t_TMT_A_in_s", "F_TMT_A", "t_TMT_B_in_s", "F_TMT_B", "Anz_li_Annett", "Anz_re_Annett"))


#vpdata_dol ANPASSUNG zu bearbeiten
vpdata_dol = vpdata_dol %>% 
  unite(group, c(Multi.Dol.Pil, BA.MA.Profi), sep = "")

vpdata_dol_NA = vpdata_dol %>% 
  na_if(0)

vpdata_dol_NA["52", "t_TMT_A..s."] <- 34.06

# Tell R, which variables in datasets are factors
vpdata$id <- as.factor(vpdata$id)
vpdata$group <- as.factor(vpdata$group)


## write data to Output Folder

#write.table(vpdata, file = paste("F:/Auswertung/CLINT_R/output", "vpdata.csv", sep = "/"), sep = ",", row.names = FALSE)
#write.table(controlQuestions, file = paste("F:/Auswertung/CLINT_R/output", "controlQuestions.csv", sep = "/"), sep = ",", row.names = FALSE)
#write.table(perceivedDifficulty, file = paste("F:/Auswertung/CLINT_R/output", "perceivedDifficulty.csv", sep = "/"), sep = ",", row.names = FALSE)
#write.table(clint, file = paste("F:/Auswertung/CLINT_R/output", "clint.csv", sep = "/"), sep = ",", row.names = FALSE)


## exclude CXY

vpdata <- vpdata %>% 
  filter(id != "CXY")

## Clean up workspace

remove(fileNames,pilot_vpdata,vpdata_all)
```

# Describing Datasets
## VP Data

```{r, message=FALSE}
library("tidyverse")
vpdata <- vpdata %>% 
  as_tibble()         # transform into tibble
str(vpdata) # structure of the data
```

The columns in the data are:

- `id`: participant id, `factor`
- `group`: `factor` with seven levels indicating which group participant was in: `"Multilinguals (Mul)"` or `"Translators (Tra)"`
- `gender`: `factor` indicating gender
- `HAWIE_T_value`: results of HAWIE
- `t_TMT_A_in_s`: time for TMT_A in seconds
- `F_TMT_A`: number of error in TMT_A
- `t_TMT_B_in_s`: time for TMT_B in seconds
- `F_TMT_B`: number of error in TMT_B
- `Anz_li_Annett`: number of answers indicating lefthandedness in Annett
- `Anz_re_Annett`: number of answers indicating righthandedness in Annett





## Clint: Text Output and Reading Duration

```{r, message=FALSE}
library("tidyverse")
clint <- clint %>% 
  as_tibble()         # transform into tibble
str(clint) # structure of the data
```

The columns in the data are:

- `id`: participant id, `factor`
- `group`: `factor` with seven levels indicating which group participant was in: `"Multilinguals (Mul)"` or `"Translators (Tra)"`
- `task`: `factor` indicating whether text output was generated during `"Copying Task"` or `"Translating Task"`
- `sentences`: number of processed sentences
- `chars`: number of produced chars without error corrections
- `charsTotal`: number of produced chars in total.
- `charsErrors`: number of char errors (e.g. pressing "BackSpace")
- `text`: `factor` indicating if `"Text 1"` or `"Text 2"` was processed
- `condition`: `factor` indicating whether text was `"English as lingua franca (ELF)"` or `"Standard English (SE)"`
- `sumReadingDuration`: time for reading text in seconds
- `avgReadingDuration`: time for reading text per sentence in seconds
- `T1_is_ELF`:`factor` indicating `"Text 1"` was in `"ELF"` or not
- `T1_is_first`:`factor` indicating `"Text 1"` was presented `"First"` or not



## Control Questions

```{r, message=FALSE}
library("tidyverse")
controlQuestions <- controlQuestions %>% 
  as_tibble()         # transform into tibble
str(controlQuestions) # structure of the data
```

The columns in the data are:

- `id`: participant id, `factor`
- `group`: `factor` with seven levels indicating which group participant was in: `"Multilinguals (Mul)"` or `"Translators (Tra)"`
- `text`: `factor` indicating if `"Text 1"` or `"Text 2"` was processed
- `question`: `factor` indicating number of question
- `correct`: indicates, if question was answered correclty
- `T1_is_ELF`:`factor` indicating `"Text 1"` was in `"ELF"` or not
- `T1_is_first`:`factor` indicating `"Text 1"` was presented `"First"` or not



## Perceived Difficulty

```{r, message=FALSE}
library("tidyverse")
perceivedDifficulty <- perceivedDifficulty %>% 
  as_tibble()         # transform into tibble
str(perceivedDifficulty) # structure of the data
```

The columns in the data are:

- `id`: participant id, `factor`
- `group`: `factor` with seven levels indicating which group participant was in: `"Multilinguals (Mul)"` or `"Translators (Tra)"`
- `task`: `factor` with levels `"Reading"` or `"Translating"`
- `text`: `factor` indicating if `"Text 1"` or `"Text 2"` was processed
- `condition`: `factor` indicating whether text was `"English as lingua franca (ELF)"` or `"Standard English (SE)"`
- `perceivedDifficulty`: dependent variable how difficulty of task was perceived in 0-10 (cm).
- `T1_is_ELF`:`factor` indicating `"Text 1"` was in `"ELF"` or not
- `T1_is_first`:`factor` indicating `"Text 1"` was presented `"First"` or not

```{r, Englisch-Sprachtest}
ggplot(data=vpdata,aes(x=group,y=SpT_Score,))+
 geom_violin(aes(fill = group)) +
  stat_summary(fun.y = "mean", geom = "point", 
               shape = 15, color = "blue") +
  theme_set(theme_classic(base_size = 15)) +labs(y = "Total English Langugae Test Score", title='Int: English Langugae Test Score per Group')

ggplot(data=vpdata_dol_NA,aes(x=group,y=SprT_Gesamtscore,))+
 geom_violin(aes(fill = group)) +
  stat_summary(fun.y = "mean", geom = "point", 
               shape = 15, color = "blue") +
  theme_set(theme_classic(base_size = 15)) +labs(y = "Total English Langugae Test Score", title='Dol: English Langugae Test Score per Group')
```
```{r, TMT}
ggplot(data=vpdata,aes(x=group,y=t_TMT_A_in_s))+
 geom_violin(aes(fill = group)) +
  stat_summary(fun.y = "mean", geom = "point", 
               shape = 15, color = "blue") +
  theme_set(theme_classic(base_size = 15)) +labs(y = "Total English Langugae Test Score", title='Int: English Langugae Test Score per Group')


Abszisse <- "group" 
Balkenfarbe <- "gender"
AV <- "t_TMT_B_in_s" 
CI <- .95  
data2 <- na.omit(vpdata[,c(Abszisse, Balkenfarbe, AV)])
KIB.halbe <- function(x) sd(x)/sqrt(length(x))*qt((1+CI)/2, length(x)-1)
data.aggr <- ddply(data2, c(Abszisse, Balkenfarbe), with,
each(Mean=mean, KIB.halbe)(eval(parse(text=AV))))
limits <- aes(ymax = Mean + KIB.halbe, ymin = Mean - KIB.halbe)
ggplot(data.aggr, aes_string(fill=Balkenfarbe, y="Mean", x=Abszisse)) +
scale_fill_grey(name=Balkenfarbe , start=.5, end=1) +
geom_bar(colour="black", position=position_dodge(width=0.9), stat="identity") +
geom_errorbar(limits, position=position_dodge(width=0.9), width=0.25) +
labs(y="completion time (sec)", title='Int: TMT_B Performance') + theme_bw() +
theme(axis.text.x = element_text(angle=90, hjust=1))

Abszisse <- "group" 
Balkenfarbe <- "Geschlecht"
AV <- "t_TMT_B..s." 
CI <- .95  
data2 <- na.omit(vpdata_dol_NA[,c(Abszisse, Balkenfarbe, AV)])
KIB.halbe <- function(x) sd(x)/sqrt(length(x))*qt((1+CI)/2, length(x)-1)
data.aggr <- ddply(data2, c(Abszisse, Balkenfarbe), with,
each(Mean=mean, KIB.halbe)(eval(parse(text=AV))))
limits <- aes(ymax = Mean + KIB.halbe, ymin = Mean - KIB.halbe)
ggplot(data.aggr, aes_string(fill=Balkenfarbe, y="Mean", x=Abszisse)) +
scale_fill_grey(name=Balkenfarbe , start=.5, end=1) +
geom_bar(colour="black", position=position_dodge(width=0.9), stat="identity") +
geom_errorbar(limits, position=position_dodge(width=0.9), width=0.25) +
labs(y="completion time (sec)", title='Dol: TMT_B Performance') + theme_bw() +
theme(axis.text.x = element_text(angle=90, hjust=1))


vpdata_dol_NA %>% 
  ggplot(mapping = aes(x = t_TMT_B..s., y = F_TMT_B)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  labs(y="Erros", x= "completion time (sec)", title='Dol: TMT_B Performance')+
  #facet_wrap(~group) +
  ylim(0,9)


```
```{r, Audiometrie (nur Dol)}
###########################################################
##                       Grafik fÃ¼r rechts               ##
###########################################################

#wichtigen variablen selektieren
vpdata_dol_audio_re = vpdata_dol_NA %>% 
  select(group, Geschlecht, contains("re..dB."))

#Mittelwert ausrechnen
aggregate_vpdata_dol_audio <- aggregate(vpdata_dol_audio_re[, 3:10], list(vpdata_dol_audio$group), mean, na.rm=TRUE)

#Spalten umbennen
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X1kHZ_re..dB."] <- "1_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X2kHZ_re..dB."] <- "2_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X3kHZ_re..dB."] <- "3_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X4kHZ_re..dB."] <- "4_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X6kHZ_re..dB."] <- "6_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X8kHZ_re..dB."] <- "8_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X0.5kHZ_re..dB."] <- "0.5_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X0.25kHZ_re..dB."] <- "0.25_kHZ"


#long Format umformen
aggregate_vpdata_dol_audio_long = aggregate_vpdata_dol_audio %>%
  pivot_longer(., cols = ends_with("HZ"), names_to = "Frequenz", values_to = "dB")

#Grafik
ggplot(aggregate_vpdata_dol_audio_long, aes(x = Frequenz, y = dB, group = Group.1, color = Group.1, linetype = Group.1))+geom_point()+geom_line()+labs(title="Audimoetrie rechts")
       
###########################################################
##                       Grafik fÃ¼r links               ##
###########################################################

#wichtigen variablen selektieren
vpdata_dol_audio_li = vpdata_dol_NA %>% 
  select(group, Geschlecht, contains("li..dB."))

#Mittelwert ausrechnen
aggregate_vpdata_dol_audio <- aggregate(vpdata_dol_audio_li[, 3:10], list(vpdata_dol_audio$group), mean, na.rm=TRUE)

#Spalten umbennen
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X1kHZ_li..dB."] <- "1_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X2kHZ_li..dB."] <- "2_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X3kHZ_li..dB."] <- "3_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X4kHZ_li..dB."] <- "4_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X6kHZ_li..dB."] <- "6_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X8kHZ_li..dB."] <- "8_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X0.5kHZ_li..dB."] <- "0.5_kHZ"
names(aggregate_vpdata_dol_audio)[names(aggregate_vpdata_dol_audio) == "X0.25kHZ_li..dB."] <- "0.25_kHZ"


#long Format umformen
aggregate_vpdata_dol_audio_long = aggregate_vpdata_dol_audio %>%
  pivot_longer(., cols = ends_with("HZ"), names_to = "Frequenz", values_to = "dB")

#Grafik
ggplot(aggregate_vpdata_dol_audio_long, aes(x = Frequenz, y = dB, group = Group.1, color = Group.1, linetype = Group.1))+geom_point()+geom_line()+labs(title="Audimoetrie links")
```

