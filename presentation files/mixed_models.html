<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Mixed Models in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Henrik Singmann (University of Warwick) Twitter: @HenrikSingmann" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Mixed Models in R
## A Practical Introduction
### Henrik Singmann (University of Warwick)<br/>Twitter: <a href='https://twitter.com/HenrikSingmann'><span class="citation">@HenrikSingmann</span></a>
### Apr 2020

---






# Mixed Model Analysis

Steps for running a mixed model analysis:
1. Identify desired fixed-effects structure
2. Identify random-effects grouping factors
3. Identify *maximal random-effects structure justified by the design*:
    - Which factors/terms vary within levels of (i.e. are crossed with) each random-effects grouping factor? 
    - Are there replicates within factor levels (or parameters/coefficients) for levels of random-effects grouping factor?
4. Choose method for calculating *p*-values and fit maximal model
5. In case of singular fits: Iteratively reduce random-effects structure until all degenerate random-effects parameters are removed/fit is not singular.


---

# Mixed Models

- Modern class of statistical models that extend regular regression models
- Implement *partial pooling* via random-effects parameters
- Random-effects parameters can account for dependencies among related data points

--

.pull-left[

### Fixed Effects
- Overall  or *population-level average* effect of specific model term (i.e., main effect, interaction, parameter) on dependent variable
- Independent of stochastic variability controlled for by random effects
- Hypothesis tests on fixed effect interpreted as hypothesis tests for terms in standard ANOVA or regression model
- Possible to test specific hypotheses among factor levels (e.g., planned contrasts)

]

.pull-right[
### Random Effects

- *Random-effects grouping factors*: Categorical variables that capture random or stochastic variability (e.g., participants, items, groups, or other hierarchical-structures).
- In experimental settings, random effects grouping factors often part of design one wants to generalize over.
- Random effects factor out idiosyncrasies of sample, thereby providing a more general estimate of the fixed effects of interest.
- *Random-effects parameters*: Provide each level of random-effects grouping factor with idiosyncratic parameter set.

]

---
class: inline-grey, small

### Mixed Models Formulas with `lme4`/`afex` 

- Full mixed model is specified in one formula. For example: `dv ~ fixed + (random|id)`
- Random effects are inside parentheses with a `|`:
  - random-effects parameters left of `|`
  - random-effects grouping factor is right of `|`
- Fixed effects are usually outside parentheses

| Formula | Interpretation  |
| ------------------------|----------------------------------|
| &lt;code&gt;(1&amp;#124;s)&lt;/code&gt;               | random intercepts for `s` (i.e., by-`s` random intercepts) | 
| &lt;code&gt;(1&amp;#124;s)+(1&amp;#124;i)&lt;/code&gt;   |  by-`s` and by-`i` (i.e., crossed) random intercepts |
| &lt;code&gt;(a&amp;#124;s)&lt;/code&gt; or &lt;code&gt;(1+a&amp;#124;s)&lt;/code&gt;               | by-`s` random intercepts and by-`s` random slopes for `a` plus their correlation|
| &lt;code&gt;(a*b&amp;#124;s)&lt;/code&gt;                 | by-`s` random intercepts and by-`s` random slopes for `a`, `b`, and the `a:b` interaction plus correlations among the by-`s` random effects parameters |
| &lt;code&gt;(0+a&amp;#124;s)&lt;/code&gt;  | by-`s` random slopes for `a` and no random intercept |
| &lt;code&gt;(a&amp;#124;&amp;#124;s)&lt;/code&gt; | by-`s` random intercepts and by-`s` random slopes for `a`, but no correlation (expands to: &lt;code&gt;(0+a&amp;#124;s) + (1&amp;#124;s)&lt;/code&gt;) |

*Note*: Suppressing correlation parameters via `||` works only for numerical variables in `lmer` and not for factors. In `afex::mixed` it works if  `expand_re = TRUE`.


---
class: small

# Example Data

![](cognition_cutout.png)


---
class: small, inline-grey

### Skovgaard-Olsen et al. (2016)

- Conditional = *if-then* statement; e.g., If global warning continues, London will be flooded.
- Bayesian reasoning often assumes 'the Equation': *P*(if *A* then *B*) = *P*(*B*|*A*)
- Our question: Does 'the Equation' hold? 
- Participants provide idiosyncratic estimates of both *P*(if *A* then *B*) and *P*(*B*|*A*).

- ~100 participants recruited via `crowdflower.com` worked on 12 items:

&gt; Sophia's scenario: Sophia wishes to find a nice present for her 13-year-old son, Tim, for Christmas. She is running on a tight budget, but she knows that Tim loves participating in live role-playing in the forest and she is really skilled at sewing the orc costumes he needs. Unfortunately, she will not be able to afford the leather parts that such costumes usually have, but she will still be able to make them look nice.

--

(1) *P*(*B*|*A*) (`B_given_A`):
  &gt; Suppose Sophia makes Tim an orc costume.
  &gt; Under this assumption, how probable is it that the following sentence is true:   
  &gt; Tim will be excited about his present.

--

(2) *P*(if *A* then *B*) (`if_A_then_B`):
  &gt; Could you please rate the probability that the following sentence is true:   
  &gt; IF Sophia makes Tim an orc costume, THEN he will be excited about his present.

---

class: small 

.pull-left[
### Skovgaard-Olsen et al. (2016)

- Does 'the Equation' (i.e., *P*(if *A* then *B*) = *P*(*B*|*A*)) hold? 

- Participants provided idiosyncratic estimates of *P*(if *A* then *B*) (`if_A_then_B`) and *P*(*B*|*A*) (`B_given_A`) for each item.
- Each participant worked on 12 items.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
